<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <script src="https://code.jquery.com/jquery-3.3.1.js"></script>
  <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js" integrity="sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy"
    crossorigin="anonymous"></script>

  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css" integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO"
    crossorigin="anonymous">
  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.5.0/css/all.css" integrity="sha384-B4dIYHKNBt8Bc12p+WXckhzcICo0wtJAoU8YZTY5qE0Id1GSseTk6S+L3BlXeVIU"
    crossorigin="anonymous">
    <script src="https://www.gstatic.com/firebasejs/5.5.9/firebase.js"></script>
    <script src="./events.js"></script>
    <script src="./restaurants.js"></script>
    <script src="./db.js"></script>
  <title>Document</title>
</head>
<style>

  li {
    list-style: none;
    text-transform: capitalize;
}

.btn {
  margin: 5px ;
  
}
.img_icons {
  width: 40px;
  height: 40px;
  padding: 0;
  margin: 0;
}
</style>

<body>
  <div class="container-fluid">

    <div class="card" style="width: 100%;">
      <form class="form-inline my-2 my-lg-0">
        <input class="form-control mr-sm-2" type="search" placeholder="Search" id="queryval" aria-label="Search" value="Miami">
        <button class="btn btn-outline-success my-2 my-sm-0" data-toggle="modal" data-target="#exampleModal" id="btn1"
          type="submit">Search</button>
      </form>
      <br>
      <br>

      <div class="card-body">

      </div>


    </div>
    <div class="accordion" id="accordionExample">
        <div class="card">
            <div class="card-header" id="headingsix">
              <h5 class="mb-0">
                <button class="btn btn-link  stats" type="button" data-stat="Top 5 Places"  data-toggle="collapse" data-target="#collapsesix"
                  aria-expanded="true" aria-controls="collapsesix">
                  
                  <i class="fas fa-search-location" >Top 5 places</i>
                </button>
              </h5>
            </div>
    
            <div id="collapsesix" class="collapse" aria-labelledby="headingsix" data-parent="#accordionExample">
              <div class="card-body">
                <div class="row">
                  <div class="col-md-3">
                    <ul id=topcities>
                      
    
    
                    </ul>
                  </div>
                </div>
    
              </div>
            </div>
          </div>
      <div class="card">
        <div class="card-header" id="headingfive">
          <h5 class="mb-0">
            <button class="btn btn-link stats" type="button" data-stat="weather" data-toggle="collapse" data-target="#collapsefive"
              aria-expanded="true" aria-controls="collapseOne">
              <i class="fas fa-sun">Weather</i>
            </button>
          </h5>
        </div>

        <div id="collapsefive" class="collapse" aria-labelledby="headingfive" data-parent="#accordionExample">
          <div class="card-body">
            <div class="row">
              <div class="col-md-3">
                <ul>
                  <li id="city"></li>
                  <li id='temp'></li>
                  <li id="humidity"></li>
                  <li id="wind"></li>


                </ul>
              </div>
            </div>

          </div>
        </div>
      </div>
      <div class="card">
        <div class="card-header" id="headingOne">
          <h5 class="mb-0">
            <button class="btn btn-link stats" type="button" data-stat="Pictures" data-toggle="collapse" data-target="#collapseOne" aria-expanded="true"
              aria-controls="collapseOne">
              <i class="far fa-images"> Pictures</i>
            </button>
          </h5>
        </div>

        <div id="collapseOne" class="collapse" aria-labelledby="headingOne" data-parent="#accordionExample">
          <div class="card-body">
            <div class="row">
              <div class="col-md-3">

              </div>
            </div>
            <div id="carouselExampleSlidesOnly" class="carousel slide" data-ride="carousel">
              <div class="carousel-inner" id="target">

              </div>
            </div>
          </div>
        </div>
      </div>
      <div class="card">
        <div class="card-header" id="headingTwo">
          <h5 class="mb-0">
            <button class="btn btn-link collapsed stats" data-stat="events" type="button" data-toggle="collapse" data-target="#collapseTwo"
              aria-expanded="false" aria-controls="collapseTwo">
              <i class="fas fa-calendar-alt"> Events</i>
            </button>
          </h5>
        </div>
        <div id="collapseTwo" class="collapse" aria-labelledby="headingTwo" data-parent="#accordionExample">
          <div class="card-body">
            <div class="accordion" id="accordionevents"></div>
          </div>
        </div>
      </div>
      <div class="card">
        <div class="card-header" id="headingThree">
          <h5 class="mb-0">
            <button class="btn btn-link collapsed stats" data-stat="restaurants" type="button" data-toggle="collapse" data-target="#collapseThree"
              aria-expanded="false" aria-controls="collapseThree">
              <i class="fas fa-utensils"> Restaurants</i>
            </button>
          </h5>
        </div>
        <div id="collapseThree" class="collapse" aria-labelledby="headingThree" data-parent="#accordionExample">
          <div class="card-body" id="restaurant">
              <div class="accordion" id="accordionrestaurants"></div>
          </div>
        </div>
      </div>
      <div class="card">
        <div class="card-header" id="headingfour">
          <h5 class="mb-0">
            <button class="btn btn-link collapsed stats" data-stat="national parks" type="button" data-toggle="collapse" data-target="#collapsefour"
              aria-expanded="false" aria-controls="collapseThree">
              <i class="fas fa-landmark"> National Parks</i>
            </button>
          </h5>
        </div>
        <div id="collapsefour" class="collapse" aria-labelledby="headingThree" data-parent="#accordionExample">
          <div class="card-body" id="national-parks">
          </div>
        </div>
      </div>
    </div>



  </div>
  <div class="modal" id="exampleModal" tabindex="-1" role="dialog">
    <div class="modal-dialog" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">Loading your results , please wait</h5>

        </div>
        <div class="modal-body">
          <img src="./Loading_icon.gif" alt="" srcset="">
        </div>

      </div>
    </div>
  </div>
</body>
<script>

  $(document).ready(function () {
   


$("body").on("click" , ".stats", function(){


statistics($(this).data("stat"))

})

$("body").on("click" , ".topcities", function(){
 
  var name = $(this).text();
  addCity(name.toLowerCase());
 console.log ("function called");
  var myUrl =
        'https://maps.googleapis.com/maps/api/geocode/json?key=AIzaSyBK9jkFfnWFcee-sTKz_Y14T4RMu_SBbuo&address=city%20of%20' +
        name + '&sensor=false'
        console.log (myUrl);
anotherquery(myUrl);

})


    $("#btn1").on("click", function (e) {
      e.preventDefault();

      var test = $('#queryval').val();
addCity(test.toLowerCase());
      var myUrl =
        'https://maps.googleapis.com/maps/api/geocode/json?key=AIzaSyBK9jkFfnWFcee-sTKz_Y14T4RMu_SBbuo&address=city%20of%20' +
        test + '&sensor=false'
      // loadDoc(myUrl , myFunction);
      console.log (myUrl);
      anotherquery(myUrl);
    })

  })




  function anotherquery(requestUrl) {
    
    $.ajax({
      url: requestUrl,
      method: 'GET',
    }).done(function (result) {
      //console.log(result);
      // console.log(result)
      // console.log("Request Status: " + result.status);
      // console.log("Place Name: " + result.results[0].formatted_address);
      // console.log("Place ID: " + result.results[0].place_id);
      // console.log("Lat: " + result.results[0].geometry.location.lat);
      // console.log("Lng: " + result.results[0].geometry.location.lng);
      getCurrentWeather(result.results[0].formatted_address);
     // eventBrite(result.results[0].geometry.location.lat, result.results[0].geometry.location.lng);
     events("accordionevents",result.results[0].geometry.location.lat, result.results[0].geometry.location.lng);
     // restaurantInfo(result.results[0].geometry.location.lat, result.results[0].geometry.location.lng);
     restaurantInformation("accordionrestaurants",result.results[0].geometry.location.lat, result.results[0].geometry.location.lng);
      npsInfo(result.results[0].address_components[2].short_name, result.results[0].address_components[0].long_name);

      // console.log(result.results[0].address_components[2].short_name, result.results[0].address_components[0].long_name);



 myurl = "https://maps.googleapis.com/maps/api/place/details/json?placeid=" + result.results[0].place_id + "&fields=photos,name,rating,formatted_phone_number&key=AIzaSyBK9jkFfnWFcee-sTKz_Y14T4RMu_SBbuo"
 "&inputtype=textquery&fields=photos,formatted_address&key=AIzaSyBK9jkFfnWFcee-sTKz_Y14T4RMu_SBbuo&address"
var corsAnywhereUrl = "https://cors-anywhere.herokuapp.com/"
       $.ajax({
       url: corsAnywhereUrl + myurl,
        method: 'GET',
      }).done(function (result) {
        //console.log(result);

        //console.log("Google result: " + result)
        $("#target").empty();
        for (var i = 0; i < result.result.photos.length; i++) {
          myurl = "https://maps.googleapis.com/maps/api/place/photo?maxwidth=400&photoreference=" +
            result.result.photos[i].photo_reference +
            "&key=AIzaSyBK9jkFfnWFcee-sTKz_Y14T4RMu_SBbuo"
          if (i === 0) {
            $("#target").append("<div class='carousel-item active'><img class='d-block w-100' src='" + myurl + "' alt='First slide'></div>");
          } else {
            $("#target").append("<div class='carousel-item'><img class='d-block w-100' src='" + myurl + "' alt='First slide'></div>");

          }

          //$("#demo").append("<img src='"+myurl+"'>");

        }


      }).fail(function (err) {
        throw err;
      });

    }).fail(function (err) {
      throw err;
    });
  }
  function getCurrentWeather(city) {
    //console.log(city);
    var APIKey = "a1419d3616a13603e1c5b962606c26e2";

    // Here we are building the URL we need to query the database
    var queryURL = "https://api.openweathermap.org/data/2.5/weather?q=" + city + "&units=imperial&appid=" + APIKey;

    // Here we run our AJAX call to the OpenWeatherMap API
    $.ajax({
      url: queryURL,
      method: "GET"
    })
      // We store all of the retrieved data inside of an object called "response"
      .then(function (response) {

        // Log the queryURL
       // console.log(queryURL);

        // Log the resulting object
        //console.log("Open weather: " + response);

        // Transfer content to HTML
        $("#city").text("City:" + response.name + " Weather Details:");
        $("#wind").text("Wind Speed: " + response.wind.speed);
        $("#humidity").text("Humidity: " + response.main.humidity);
        $("#temp").text("Temperature (F) " + response.main.temp);

        // Log the data in the console as well
        // console.log(city);
        // console.log("Wind Speed: " + response.wind.speed);
        // console.log("Humidity: " + response.main.humidity);
        // console.log("Temperature (F): " + response.main.temp);
      });


  }

  // function eventBrite(argLatitude, argLongitude) {

  //   var token = 'SRIRFU3BOMH4X35QFAGN';
  //   var $events = $("#events");

  //   $.get('https://www.eventbriteapi.com/v3/events/search/?token=' + token + '&location.latitude=' + argLatitude + '&location.longitude=' + argLongitude + '&expand=venue', function (res) {
  //     if (res.events.length) {
  //       var s = "<ul class='eventList'>";
  //       for (var i = 0; i < res.events.length; i++) {
  //         var event = res.events[i];
  //         //console.dir(event);
  //         s += "<li><a href='" + event.url + "'>" + event.name.text + "</a> - " + event.description.text + "</li>";
  //       }
  //       s += "</ul>";
  //       $events.html(s);
  //       $('#exampleModal').modal('toggle');
  //     } else {
  //       $events.html("<p>Sorry, there are no upcoming events.</p>");
  //     }
  //   });

  // }



  var corsAnywhere = "https://cors-anywhere.herokuapp.com/";

  // function restaurantInfo(arglat, arglong) {
  //   var zomBaseUrl = "https://developers.zomato.com/api/v2.1";
  //   var zomCallCity = "/cities&key=";
  //   var zomKey = "04dffe13574d2caddf0a86ffa64f32a0";
  //   $("#restaurant").empty();
  //   $.ajax({
  //     url: "https://developers.zomato.com/api/v2.1/geocode?lat=" + arglat + "&lon=" + arglong + "&user-key=" + zomKey,
  //     method: "GET",
  //     beforeSend: function (xhr) { xhr.setRequestHeader('user-key', '04dffe13574d2caddf0a86ffa64f32a0'); },
  //   }).then(function (response) {
  //     // console.log(response);
  //     // console.log("restaurant name: " + response.nearby_restaurants[0].restaurant.name);
  //     $("#restaurant").append("<ul id='rest-list'></ul>");
  //     // console.log(response.nearby_restaurants[0].restaurant.cuisines);
  //     // console.log(response.nearby_restaurants.length);

  //     for (var i = 0; i < response.nearby_restaurants.length; i++) {
  //       $("#restaurant").append("<ul id=#rest-list" + [i] + "><li>" + response.nearby_restaurants[i].restaurant.name + "</li></ul>");
  //     }
  //   });
  // }



  // Call the NPS API
  function npsInfo(state, city) {
    npsUrl = "https://api.nps.gov/api/v1/parks?stateCode=" + state + "&limit=50&start=1&key=qpWelJUKpo0rWmkucsjPsEXnvkdRfGwQvja86FWo&fields=addresses"
    var match = false;
    $("#national-parks").empty();
    $.ajax({
      url: npsUrl,
      method: "GET",
      dataType: "JSON",
    }).done(function (response) {
      // console.log(response);
      // console.log(response.data.length);
      if (response.data.length > 0) {
        for (var i = 0; i < response.data.length; i++) {
          if (response.data[i].addresses[0] && response.data[i].addresses[0].city == city) {
            $("#national-parks").append("<p>" + response.data[i].fullName + "</p>");
            match = true;
          }
        }
      }
      if (!match) {
        $("#national-parks").append("<p>Sorry, there are no National Parks in this city.</p>");
      }
    });
  
  }


</script>


</html>